/*
------------------------------------------------------------
üìò Problem: Managers and Their Reports Summary
Difficulty: Easy
Platform: LeetCode SQL
------------------------------------------------------------

üß± Table: Employees
+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| employee_id | int      |
| name        | varchar  |
| reports_to  | int      |
| age         | int      |
+-------------+----------+
employee_id is the column with unique values for this table.
This table contains information about employees and the id of
the manager they report to. Some employees do not report to
anyone (reports_to is NULL).

------------------------------------------------------------
üéØ Goal:
Find all managers ‚Äî employees who have at least one person 
reporting to them.

For each manager, return:
  ‚Ä¢ employee_id  ‚Üí manager‚Äôs id
  ‚Ä¢ name         ‚Üí manager‚Äôs name
  ‚Ä¢ reports_count ‚Üí number of direct reports
  ‚Ä¢ average_age   ‚Üí average age of those reports (rounded)

The result should be ordered by employee_id.

------------------------------------------------------------
üìä Example 1:

Input:
+-------------+---------+------------+-----+
| employee_id | name    | reports_to | age |
+-------------+---------+------------+-----+
| 9           | Hercy   | null       | 43  |
| 6           | Alice   | 9          | 41  |
| 4           | Bob     | 9          | 36  |
| 2           | Winston | null       | 37  |
+-------------+---------+------------+-----+

Output:
+-------------+-------+---------------+-------------+
| employee_id | name  | reports_count | average_age |
+-------------+-------+---------------+-------------+
| 9           | Hercy | 2             | 39          |
+-------------+-------+---------------+-------------+

Explanation:
- Hercy manages Alice (41) and Bob (36)
- Average = (41 + 36) / 2 = 38.5 ‚Üí rounded to 39

------------------------------------------------------------
üìä Example 2:

Input:
+-------------+---------+------------+-----+ 
| employee_id | name    | reports_to | age |
+-------------+---------+------------+-----+
| 1           | Michael | null       | 45  |
| 2           | Alice   | 1          | 38  |
| 3           | Bob     | 1          | 42  |
| 4           | Charlie | 2          | 34  |
| 5           | David   | 2          | 40  |
| 6           | Eve     | 3          | 37  |
| 7           | Frank   | null       | 50  |
| 8           | Grace   | null       | 48  |
+-------------+---------+------------+-----+

Output:
+-------------+---------+---------------+-------------+
| employee_id | name    | reports_count | average_age |
+-------------+---------+---------------+-------------+
| 1           | Michael | 2             | 40          |
| 2           | Alice   | 2             | 37          |
| 3           | Bob     | 1             | 37          |
+-------------+---------+---------------+-------------+

------------------------------------------------------------
üß† Explanation (Step-by-Step):

1Ô∏è‚É£ Self-Join the Employees table
   - The manager will be on the LEFT (e1)
   - The employee reporting to them will be on the RIGHT (e2)
   - Join condition: e1.employee_id = e2.reports_to

2Ô∏è‚É£ Group by manager to count and average
   - COUNT(e2.employee_id) ‚Üí number of direct reports
   - AVG(e2.age) ‚Üí average age of reports

3Ô∏è‚É£ ROUND() function is used to round average age.

4Ô∏è‚É£ Order the final result by manager‚Äôs employee_id.

------------------------------------------------------------
‚úÖ Final SQL Solution:
*/

SELECT 
    e1.employee_id,
    e1.name,
    COUNT(e2.employee_id) AS reports_count,
    ROUND(AVG(e2.age)) AS average_age
FROM Employees e1
JOIN Employees e2
    ON e1.employee_id = e2.reports_to
GROUP BY e1.employee_id, e1.name
ORDER BY e1.employee_id;

/*
------------------------------------------------------------
üßæ Output Explanation:
Each row represents a manager and their direct reports summary.

Example:
| employee_id | name  | reports_count | average_age |
|--------------|-------|---------------|-------------|
| 9            | Hercy | 2             | 39          |

Hercy manages 2 people (Alice & Bob),
and their average age is 39 (after rounding).

------------------------------------------------------------
üìÇ File Info:
Filename: Managers_Report_Summary.sql
Author: Rushikesh Bhagwat
GitHub Repo: Top50 SQL (LeetCode Solutions with Explanations)
------------------------------------------------------------
*/
