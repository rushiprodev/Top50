# üìä LeetCode SQL - 1251. Average Selling Price

## üßæ Problem Statement

Write a SQL query to find the **average selling price** for each product.  
The `average_price` should be **rounded to 2 decimal places**.

- If a product does **not have any sold units**, its average selling price is assumed to be **0**.
- Return the result table in any order.

---

## üóÉÔ∏è Table Definitions

### `Prices` Table

| Column Name | Type |
|-------------|------|
| product_id  | int  |
| start_date  | date |
| end_date    | date |
| price       | int  |

- **Primary Key**: (product_id, start_date, end_date)
- Each row shows the **price** of a product during a date **range** (from `start_date` to `end_date`).
- No overlapping periods for the same product.

---

### `UnitsSold` Table

| Column Name   | Type |
|---------------|------|
| product_id    | int  |
| purchase_date | date |
| units         | int  |

- May contain **duplicate rows**.
- Each row indicates the **number of units sold** for a product on a specific date.

---

## üì• Example Input

### `Prices` Table

| product_id | start_date | end_date   | price |
|------------|------------|------------|-------|
| 1          | 2019-02-17 | 2019-02-28 | 5     |
| 1          | 2019-03-01 | 2019-03-22 | 20    |
| 2          | 2019-02-01 | 2019-02-20 | 15    |
| 2          | 2019-02-21 | 2019-03-31 | 30    |

### `UnitsSold` Table

| product_id | purchase_date | units |
|------------|----------------|-------|
| 1          | 2019-02-25     | 100   |
| 1          | 2019-03-01     | 15    |
| 2          | 2019-02-10     | 200   |
| 2          | 2019-03-22     | 30    |

---

## üì§ Example Output

| product_id | average_price |
|------------|----------------|
| 1          | 6.96           |
| 2          | 16.96          |

### üìò Explanation

- **Product 1:**
  - 100 units sold at ‚Çπ5 on 2019-02-25 ‚Üí 100 √ó 5 = ‚Çπ500
  - 15 units sold at ‚Çπ20 on 2019-03-01 ‚Üí 15 √ó 20 = ‚Çπ300
  - Total = ‚Çπ800, Units = 115 ‚Üí ‚Çπ800 / 115 = **6.96**

- **Product 2:**
  - 200 units sold at ‚Çπ15 ‚Üí ‚Çπ3000
  - 30 units sold at ‚Çπ30 ‚Üí ‚Çπ900
  - Total = ‚Çπ3900, Units = 230 ‚Üí ‚Çπ3900 / 230 = **16.96**

---

## ‚úÖ SQL Solution

```sql
SELECT 
    u.product_id,
    ROUND(
        IFNULL(SUM(u.units * p.price) / SUM(u.units), 0), 2
    ) AS average_price
FROM 
    UnitsSold u
JOIN 
    Prices p
ON 
    u.product_id = p.product_id
    AND u.purchase_date BETWEEN p.start_date AND p.end_date
GROUP BY 
    u.product_id;
